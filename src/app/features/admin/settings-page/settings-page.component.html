<div class="page-header">
  <div>
    <h2 class="page-title">Settings</h2>
    <p class="page-subtitle">Configure payment gateway, email, SMTP, and product details.</p>
  </div>
  <a routerLink="/" class="btn btn-ghost">View Product Page</a>
</div>

<div class="settings-grid" *ngIf="!loading(); else loadingState">
  <section class="card">
    <h3>Payment Settings</h3>
    <form class="form-grid" [formGroup]="paymentForm" (ngSubmit)="savePaymentSettings()">
      <div class="form-field">
        <label>Gateway</label>
        <select class="select" formControlName="payment_gateway">
          <option value="stripe">Stripe</option>
        </select>
      </div>
      <div class="form-field">
        <label>Public key</label>
        <input class="input" type="text" formControlName="payment_public_key" />
      </div>
      <div class="form-field">
        <label>Secret key</label>
        <input class="input" type="password" formControlName="payment_secret_key" />
        <small class="helper">Leave blank to keep current secret.</small>
      </div>
      <div class="form-grid two">
        <div class="form-field">
          <label>Currency</label>
          <input class="input" type="text" formControlName="currency" />
        </div>
        <div class="form-field">
          <label>Success URL</label>
          <input class="input" type="text" formControlName="success_url" />
        </div>
      </div>
      <div class="form-field">
        <label>Cancel URL</label>
        <input class="input" type="text" formControlName="cancel_url" />
      </div>
      <button class="btn btn-primary" type="submit" [disabled]="saving() || paymentForm.invalid">Save payment settings</button>
    </form>
  </section>

  <section class="card">
    <h3>Email Settings</h3>
    <form class="form-grid" [formGroup]="emailForm" (ngSubmit)="saveEmailSettings()">
      <div class="form-field">
        <label>Sender email</label>
        <input class="input" type="email" formControlName="sender_email" />
      </div>
      <div class="form-field">
        <label>Admin notification email</label>
        <input class="input" type="email" formControlName="admin_email" />
      </div>
      <button class="btn btn-primary" type="submit" [disabled]="saving()">Save email settings</button>
    </form>
  </section>

  <section class="card">
    <h3>Email Server Settings</h3>
    <form class="form-grid" [formGroup]="smtpForm" (ngSubmit)="saveSmtpSettings()">
      <div class="form-field">
        <label>Host</label>
        <input class="input" type="text" formControlName="smtp_host" placeholder="smtp.example.com" />
      </div>
      <div class="form-field">
        <label>SMTP Username</label>
        <input class="input" type="text" formControlName="smtp_user" placeholder="your-email@example.com" />
      </div>
      <div class="form-field">
        <label>SMTP Password</label>
        <input class="input" type="password" formControlName="smtp_pass" />
        <small class="helper">Leave blank to keep current password.</small>
      </div>
      <div class="form-field">
        <label>SMTP Port</label>
        <input class="input" type="number" formControlName="smtp_port" min="1" max="65535" />
        <small class="helper">Default: 465 (TLS), 587 (STARTTLS), or 25 (unencrypted)</small>
      </div>
      <button class="btn btn-primary" type="submit" [disabled]="saving() || smtpForm.invalid">Save SMTP settings</button>
    </form>
  </section>

  <section class="card">
    <h3>Website Branding</h3>
    <form class="form-grid" [formGroup]="brandingForm" (ngSubmit)="saveBrandingSettings()">
      <div class="form-field">
        <label>Website Name</label>
        <input class="input" type="text" formControlName="website_name" placeholder="One Product Store" />
        <small class="helper">This will be displayed in the header and browser title</small>
      </div>
      
      <div class="form-field">
        <label>Logo</label>
        <div class="file-upload-section">
          <div *ngIf="logoPreview()" class="image-preview-container">
            <img [src]="logoPreview()" alt="Logo preview" class="preview-image" />
            <button type="button" class="btn btn-small btn-danger" (click)="removeLogo()">Remove</button>
          </div>
          <input
            type="file"
            #logoInput
            accept="image/*"
            (change)="onLogoSelected($event)"
            style="display: none"
          />
          <button type="button" class="btn btn-outline" (click)="logoInput.click()" [disabled]="saving()">
            {{ logoPreview() ? 'Change Logo' : 'Upload Logo' }}
          </button>
        </div>
        <small class="helper">Upload your website logo image (displayed in header)</small>
      </div>
      
      <div class="form-field">
        <label>Favicon</label>
        <div class="file-upload-section">
          <div *ngIf="faviconPreview()" class="image-preview-container">
            <img [src]="faviconPreview()" alt="Favicon preview" class="preview-image favicon-preview" />
            <button type="button" class="btn btn-small btn-danger" (click)="removeFavicon()">Remove</button>
          </div>
          <input
            type="file"
            #faviconInput
            accept="image/*,.ico"
            (change)="onFaviconSelected($event)"
            style="display: none"
          />
          <button type="button" class="btn btn-outline" (click)="faviconInput.click()" [disabled]="saving()">
            {{ faviconPreview() ? 'Change Favicon' : 'Upload Favicon' }}
          </button>
        </div>
        <small class="helper">Upload your website favicon (displayed in browser tab)</small>
      </div>
      
      <button class="btn btn-primary" type="submit" [disabled]="saving() || brandingForm.invalid">Save branding settings</button>
    </form>
  </section>


  <section class="card">
    <h3>Email Templates</h3>
    <form class="form-grid" [formGroup]="templateForm" (ngSubmit)="saveTemplate()">
      <div class="form-field">
        <label>Template</label>
        <select
          class="select"
          formControlName="templateId"
          (change)="selectTemplate($any($event.target).value)"
        >
          <option *ngFor="let template of templates()" [value]="template.id">
            {{ template.name }}
          </option>
        </select>
      </div>
      <div class="form-field">
        <label>Subject</label>
        <input class="input" type="text" formControlName="subject" />
      </div>
      <div class="form-field">
        <label>HTML</label>
        <textarea class="textarea" formControlName="html"></textarea>
      </div>
      <button class="btn btn-primary" type="submit" [disabled]="saving()">Save template</button>
    </form>
  </section>
</div>

<ng-template #loadingState>
  <div class="card">Loading settings...</div>
</ng-template>
